<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>룰렛 뽑기</title>
  <style>
    body {
      margin:0; padding:0;
      background:#ffffff; color:#333;
      font-family: "Segoe UI", Roboto, "Noto Sans KR", sans-serif;
      text-align:center;
    }
    h1 {
      margin:30px 0 10px;
      font-size:40px;
      font-weight:800;
      color:#2c3e50;
    }
    .sub {
      color:#666;
      margin-bottom:25px;
    }
    .card {
      max-width:850px;
      margin:0 auto;
      background:#fff;
      border-radius:16px;
      padding:25px;
      box-shadow:0 6px 20px rgba(0,0,0,.1);
    }
    .step-title {
      font-size:18px; font-weight:600; margin-bottom:10px;
    }
    .counter {
      display:flex; justify-content:center; align-items:center; gap:12px; margin:12px 0;
    }
    .btn {
      border:none; border-radius:8px; padding:10px 16px;
      font-size:18px; font-weight:700; cursor:pointer;
      background:#3498db; color:white; transition:.2s;
    }
    .btn:hover { background:#2980b9; }
    .btn-ghost {
      background:#eee; color:#333; border:1px solid #ccc;
    }
    .badge {
      font-size:13px; color:#888; margin-bottom:20px;
    }
    canvas {
      background:#fff;
      border-radius:50%;
      box-shadow:0 4px 12px rgba(0,0,0,.15);
      margin-top:10px;
    }
    .indicator {
      width:0;height:0;margin:0 auto;
      border-left:14px solid transparent;
      border-right:14px solid transparent;
      border-bottom:20px solid #e74c3c;
    }
    .cta { margin-top:18px; }
    .inputs {
      display:none; gap:10px; margin-top:20px; flex-wrap:wrap; justify-content:center;
    }
    .inputs.active { display:flex; }
    .text {
      padding:10px; border:1px solid #ccc; border-radius:8px;
      font-size:15px; width:160px;
    }
    .actions { display:none; gap:12px; margin-top:18px; justify-content:center; }
    .result { margin-top:16px; font-size:20px; font-weight:700; color:#e67e22; min-height:28px; }
  </style>
</head>
<body>
  <h1>룰렛 뽑기</h1>
  <div class="sub">돌려서 결정하세요!</div>

  <div class="card">
    <div class="step-title">1. 룰렛 선택지 개수를 정해주세요.</div>
    <div class="counter">
      <button class="btn btn-ghost" id="plus">＋</button>
      <div id="count" style="min-width:48px; font-size:22px; font-weight:800;">3</div>
      <button class="btn btn-ghost" id="minus">－</button>
    </div>
    <div class="badge">(2개 ~ 15개 설정 가능)</div>

    <div class="indicator"></div>
    <canvas id="wheel" width="360" height="360"></canvas>

    <div class="cta">
      <button class="btn" id="lockCount">개수 설정 완료</button>
    </div>

    <div id="inputs" class="inputs"></div>
    <div class="actions" id="actions">
      <button class="btn" id="spinBtn">룰렛 돌리기</button>
      <button class="btn btn-ghost" id="resetBtn">초기화</button>
    </div>
    <div class="result" id="result"></div>
  </div>

  <script>
    const COLORS = ["#ffb3ba","#ffdfba","#ffffba","#baffc9","#bae1ff",
                    "#f4b6c2","#f7d9aa","#c2f0c2","#b5ead7","#c7ceea",
                    "#ffdac1","#e2f0cb","#ffb347","#a0e7e5","#c9f9ff"];

    const wheel = document.getElementById('wheel');
    const ctx = wheel.getContext('2d');
    const countEl = document.getElementById('count');
    const resEl = document.getElementById('result');
    const inputsBox = document.getElementById('inputs');
    const actions = document.getElementById('actions');

    let count = 3;
    let labels = [];
    let angleOffset = 0;
    let spinning = false;

    function defaultLabels(n){
      const base = Array.from({length:15}, (_,i)=>String.fromCharCode(65+i));
      return base.slice(0,n);
    }

    function drawWheel(n, names){
      const cx = wheel.width/2, cy = wheel.height/2, r = wheel.width/2;
      ctx.clearRect(0,0,wheel.width,wheel.height);

      const arc = (2*Math.PI)/n;
      for(let i=0;i<n;i++){
        ctx.beginPath();
        ctx.moveTo(cx,cy);
        ctx.fillStyle = COLORS[i%COLORS.length];
        ctx.arc(cx,cy,r, angleOffset + i*arc, angleOffset + (i+1)*arc);
        ctx.closePath(); ctx.fill();

        // 글씨 (항상 평행하게)
        ctx.save();
        ctx.translate(cx,cy);
        ctx.rotate(angleOffset + i*arc + arc/2);
        ctx.textAlign="center"; ctx.fillStyle="#2c3e50";
        ctx.font="bold 16px 'Segoe UI', sans-serif";
        ctx.rotate(- (angleOffset + i*arc + arc/2)); // 평행하게 맞추기
        ctx.fillText(names?.[i] ?? `항목${i+1}`, 0, -r*0.6);
        ctx.restore();
      }
    }

    function clamp(v,min,max){ return Math.max(min, Math.min(max,v)); }

    document.getElementById('plus').onclick = () => {
      count = clamp(count+1, 2, 15);
      countEl.textContent = count;
      drawWheel(count, defaultLabels(count));
    };
    document.getElementById('minus').onclick = () => {
      count = clamp(count-1, 2, 15);
      countEl.textContent = count;
      drawWheel(count, defaultLabels(count));
    };

    document.getElementById('lockCount').onclick = () => {
      inputsBox.classList.add('active');
      inputsBox.innerHTML = "";
      labels = defaultLabels(count);
      for(let i=0;i<count;i++){
        const inp=document.createElement('input');
        inp.className="text"; inp.placeholder=`항목 ${i+1}`;
        inp.value=labels[i];
        inp.oninput=()=>{ labels[i]=inp.value.trim()||`항목${i+1}`; drawWheel(count, labels); };
        inputsBox.appendChild(inp);
      }
      actions.style.display="flex";
      resEl.textContent="";
      drawWheel(count, labels);
    };

    const easeOutCubic=t=>1-Math.pow(1-t,3);

    document.getElementById('spinBtn').onclick=()=>{
      if(spinning) return;
      if(!labels.length) labels=defaultLabels(count);

      spinning=true; resEl.textContent="";
      const duration=3000;
      const start=performance.now();
      const startAngle=angleOffset;
      const extra=(Math.random()*360+720)*Math.PI/180;
      const endAngle=startAngle+extra;

      const tick=(now)=>{
        const t=Math.min((now-start)/duration,1);
        const eased=easeOutCubic(t);
        angleOffset=startAngle+(endAngle-startAngle)*eased;
        drawWheel(count,labels);
        if(t<1) requestAnimationFrame(tick);
        else{
          spinning=false;
          const deg=(angleOffset*180/Math.PI)%360;
          const arc=360/count;
          const index=Math.floor((360-(deg%360))/arc)%count;
          resEl.textContent=`결과: ${labels[index]}`;
        }
      };
      requestAnimationFrame(tick);
    };

    document.getElementById('resetBtn').onclick=()=>{
      labels=[];
      inputsBox.classList.remove('active');
      inputsBox.innerHTML="";
      actions.style.display="none";
      resEl.textContent="";
      angleOffset=0;
      drawWheel(count, defaultLabels(count));
    };

    drawWheel(count, defaultLabels(count));
  </script>
</body>
</html>
